<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RollerCoin Analyzer Pro</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YY4HR4G1LV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-YY4HR4G1LV');
</script>

<body>
  <div class="container">
    <h1>RollerCoin Analyzer Pro</h1>

    <div class="card">
      <label for="username">Username:</label>
      <input type="text" id="username" placeholder="Digite seu username" value="">
      <button id="analisarBtn">Analisar</button>
      <div id="status" class="status">Digite um username e clique em Analisar</div>
      <div id="progress" class="progress" style="display:none;">
        <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="guia">Como Utilizar</div>
      <div class="tab" data-tab="resumo">Resumo & Perfil</div>
      <div class="tab" data-tab="miners">Impact Analyzer</div>
      <div class="tab" data-tab="buyanalyzer">Buy Analyzer</div>
      <div class="tab" data-tab="mergecalculator">Merge Calculator</div>
      <div class="tab" data-tab="mergevsmarket">Merge Vs Market</div>
      <div class="tab" data-tab="rstsellanalyzer">RST Sell Analyzer</div>
      <div class="tab" data-tab="inventario">Invent√°rio & Troca</div>
      <div class="tab" data-tab="debug">Debug Info</div>
      <div class="tab" data-tab="racks">Racks</div>
    </div>

    <div id="guia" class="card tab-content active"></div>
    <div id="resumo" class="card tab-content"></div>
    <div id="miners" class="card tab-content"></div>
    <div id="buyanalyzer" class="card tab-content"></div>
    <div id="mergecalculator" class="card tab-content"></div>
    <div id="mergevsmarket" class="tab-content"></div>
    <div id="rstsellanalyzer" class="tab-content"></div>
    <div id="inventario" class="card tab-content"></div>
    <div id="debug" class="card tab-content"></div>
    <div id="racks" class="card tab-content"></div>
  </div>

  <!-- Scripts em ordem de depend√™ncia - MUITO IMPORTANTE A ORDEM! -->
  <script src="data/minersData.js"></script>
  <script src="data/state.js"></script>
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/api.js"></script>
  <script src="js/calculations.js"></script>

  <!-- Merge Analyzer Dependencies (ANTES do mergeAnalyzer.js!) -->
  <script src="js/mergePrices.js"></script>
  <script src="js/mergeParser.js"></script>

  <!-- UI Components -->
  <script src="js/ui/guia.js"></script>
  <script src="js/ui/resumo.js"></script>
  <script src="js/ui/miners.js"></script>
  <script src="js/ui/buyAnalyzer.js"></script>
  <script src="js/ui/mergeCalculator.js"></script>
  <script src="js/ui/tabs.js"></script>
  <script src="js/ui/mergeVsMarket.js"></script>
  <script src="js/ui/inventario.js"></script>
  <script src="js/ui/debug.js"></script>
  <script src="js/ui/racks.js"></script>
  <script src="js/ui/rstSellAnalyzer.js"></script>
  <script src="js/apiData.js"></script>


  <!-- Inicializa√ß√£o - Deve ser o √öLTIMO script -->
  <script>
    // Fun√ß√£o para analisar usu√°rio
    async function analisarUsuario(username) {
      const button = document.getElementById('analisarBtn');
      button.disabled = true;

      try {
        const user = await API.getUserDataByNick(username);
        State.setUserData(user);
        if (typeof gtag !== 'undefined') {
          gtag('event', 'perfil_analisado', {
            'username': username
          });
          console.log('üìä Analytics: Perfil analisado -', username);
        }
        UI_Resumo.mostrar(user);
        UI_Miners.mostrar(user);
        UI_BuyAnalyzer.mostrar(user);
        UI_Inventario.mostrar(user);
        UI_Debug.mostrar(user);
        UI_Racks.mostrar(user);

        // Merge Analyzer √© inicializado sob demanda (ao clicar na aba)

        Utils.hideProgress();
        document.getElementById('status').innerHTML = '<span class="success">An√°lise conclu√≠da com sucesso!</span>';
      } catch (err) {
        Utils.hideProgress();
        document.getElementById('status').innerHTML = '<span class="error">Erro: ' + err.message + '</span>';
        console.error(err);
      } finally {
        button.disabled = false;
      }
    }

    // Inicializa√ß√£o quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function () {
      // Verificar se todos os m√≥dulos foram carregados
      console.log('Verificando m√≥dulos carregados...');
      console.log('CONFIG:', typeof CONFIG !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('State:', typeof State !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('Utils:', typeof Utils !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('API:', typeof API !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('Calculations:', typeof Calculations !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('MergePrices:', typeof MergePrices !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('MergeParser:', typeof MergeParser !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Guia:', typeof UI_Guia !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Resumo:', typeof UI_Resumo !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Miners:', typeof UI_Miners !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_BuyAnalyzer:', typeof UI_BuyAnalyzer !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_MergeAnalyzer:', typeof UI_MergeAnalyzer !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_MergeCalculator:', typeof UI_MergeCalculator !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Inventario:', typeof UI_Inventario !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Debug:', typeof UI_Debug !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Racks:', typeof UI_Racks !== 'undefined' ? '‚úÖ' : '‚ùå');
      console.log('UI_Tabs:', typeof UI_Tabs !== 'undefined' ? '‚úÖ' : '‚ùå');

      // Inicializar interface
      UI_Guia.mostrar();
      UI_MergeCalculator.mostrar();
      UI_Tabs.init();

      // Event listeners
      document.getElementById('analisarBtn').addEventListener('click', async () => {
        const username = document.getElementById('username').value.trim();
        if (!username) {
          document.getElementById('status').innerHTML = '<span class="error">Digite um username</span>';
          return;
        }

        await analisarUsuario(username);
      });

      document.getElementById('username').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('analisarBtn').click();
        }
      });

      console.log('‚úÖ Sistema inicializado com sucesso!');
    });
  </script>
</body>

</html>